///////////////////////////////////////////////////////////////////////
// Express Server
///////////////////////////////////////////////////////////////////////
var express = require('express');
var bodyParser = require('body-parser');
var outmsg = require('./messages/server-msg.js');
///////////////////////////////////////////////////////////////////////
// Collection and Documents needed
///////////////////////////////////////////////////////////////////////
var {mongoose} = require('./db/mongoose-ic').mongoose;
var {routingModel} = require('./models/rout-model-ic').routingModel;
var {userModel} = require('./models/user-model-ic').userModel;

///////////////////////////////////////////////////////////////////////
// Server
///////////////////////////////////////////////////////////////////////
var app = express();

// We have to use bodyParser to get the JSON and convert it into an object
app.use(bodyParser.json());

///////////////////////////////////////////////////////////////////////
// Create an User
///////////////////////////////////////////////////////////////////////
app.post('/user', (request, response) => {
// We have to use bodyParser to get the JSON and convert it into an object

outmsg.msg('---body---\n');
  outmsg.msg(request.body);

  var user = new userModel({
    name: request.body.name,
    signature: request.body.signature,
    email: request.body.email,
    active: false
  });

  user.save().then( (doc) => {
    console.log('Saved:\n', JSON.stringify(doc, undefined, 2));
    response.send(doc);

  }, (e) => {
    console.log('Unable to save the model userModel', e);
    response.status(400).send(e);
  });


});

///////////////////////////////////////////////////////////////////////
// Create a routing
///////////////////////////////////////////////////////////////////////
app.post('/routing', (request, response) => {


});

///////////////////////////////////////////////////////////////////////
// Server listening on port 3000
///////////////////////////////////////////////////////////////////////
app.listen(3000 ,() => {
  outmsg.msg(outmsg.MSG_SERVER_STARTED_ON, 3000);

});

///////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////

// var mongoose = require('mongoose');
//
//
// mongoose.Promise = global.Promise;
// mongoose.connect('mongodb://localhost:27017/RoutinApp002');

// dd
// create a model

// var {mongoose} = require('./db/mongoose-ic').mongoose;

// var routingModel = mongoose.model('UserTab', {
//
//   name: { type: String, required: true },
//   signature: { type: String, required: true, minlength: 1, trim: true },
//   active: { type: Boolean, default: false},
//   timeStamp: { type: String, default: null },
//   email: { type: String, required: true, trim: true, minlength:3}
// });

//
// var newRoutingModel = new routingModel({
//
//   name: 'Arnold Schwarzenegger',
//   signature: 'jfdsoijd09dik',
//   email: 'arnold@gmail.com'
// //  timeStamp: '01.01.2017'
//
// });
//
// newRoutingModel.save().then( (doc) => {
//   console.log('Saved:\n', JSON.stringify(doc, undefined, 2));
// //  console.log('-----------', doc);
// //  console.log('Saved:', JSON.stringify(doc, undefined, 2));
// }, (e) => {
//   console.log('Unable to save the model newRoutingModel', e);
// });
